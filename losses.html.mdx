---
description: NumPy loss functions aimed to be used during the models' evaluation.
  The most important train signal is the forecast error, which is the difference between
  the observed value $y_{\tau}$ and the prediction $\hat{y}_{\tau}$, at time $y_{\tau}$:$$e_{\tau}
  = y_{\tau}-\hat{y}_{\tau} \qquad \qquad \tau \in \{t+1,\dots,t+H \}$$ The train
  loss summarizes the forecast errors in different evaluation metrics.<br/><br/>
output-file: losses.html
title: NumPy Evaluation

---

# 1. Scale-dependent Errors

## Mean Absolute Error

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L29"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### mae

> ``` text
>  mae (y:numpy.ndarray, y_hat:numpy.ndarray,
>       weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates Mean Absolute Error (MAE) between y and y_hat. MAE measures
the relative prediction accuracy of a forecasting method by calculating
the deviation of the prediction and the true value at a given time and
averages these devations over the length of the series.

$$ \mathrm{MAE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}) = 
    \frac{1}{H} \sum^{t+H}_{\tau=t+1} 
    |y_{\tau} - \hat{y}_{\tau}| $$

|             | **Type**  | **Default** | **Details**                                  |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                              |
| y_hat       | ndarray   |             |                                              |
| weights     | Optional  | None        |                                              |
| axis        | Optional  | None        |                                              |
| **Returns** | **Union** |             | **Return the MAE along the specified axis.** |

## Mean Squared Error

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L76"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### mse

> ``` text
>  mse (y:numpy.ndarray, y_hat:numpy.ndarray,
>       weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates Mean Squared Error (MSE) between y and y_hat. MSE measures
the relative prediction accuracy of a forecasting method by calculating
the squared deviation of the prediction and the true value at a given
time, and averages these devations over the length of the series.

$$ \mathrm{MSE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}) = 
    \frac{1}{H} \sum^{t+H}_{\tau=t+1} (y_{\tau} - \hat{y}_{\tau})^{2} $$

|             | **Type**  | **Default** | **Details**                                  |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                              |
| y_hat       | ndarray   |             |                                              |
| weights     | Optional  | None        |                                              |
| axis        | Optional  | None        |                                              |
| **Returns** | **Union** |             | **Return the MSE along the specified axis.** |

## Root Mean Squared Error

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L123"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### rmse

> ``` text
>  rmse (y:numpy.ndarray, y_hat:numpy.ndarray,
>        weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates Root Mean Squared Error (RMSE) between y and y_hat. RMSE
measures the relative prediction accuracy of a forecasting method by
calculating the squared deviation of the prediction and the observed
value at a given time and averages these devations over the length of
the series. Finally the RMSE will be in the same scale as the original
time series so its comparison with other series is possible only if they
share a common scale. RMSE has a direct connection to the L2 norm.

$$ \mathrm{RMSE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}) = 
    \sqrt{\frac{1}{H} \sum^{t+H}_{\tau=t+1} (y_{\tau} - \hat{y}_{\tau})^{2}} $$

|             | **Type**  | **Default** | **Details**                                   |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                               |
| y_hat       | ndarray   |             |                                               |
| weights     | Optional  | None        |                                               |
| axis        | Optional  | None        |                                               |
| **Returns** | **Union** |             | **Return the RMSE along the specified axis.** |

# 2. Percentage Errors

## Mean Absolute Percentage Error

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L163"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### mape

> ``` text
>  mape (y:numpy.ndarray, y_hat:numpy.ndarray,
>        weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates Mean Absolute Percentage Error (MAPE) between y and y_hat.
MAPE measures the relative prediction accuracy of a forecasting method
by calculating the percentual deviation of the prediction and the
observed value at a given time and averages these devations over the
length of the series. The closer to zero an observed value is, the
higher penalty MAPE loss assigns to the corresponding error.

$$ \mathrm{MAPE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}) = 
    \frac{1}{H} \sum^{t+H}_{\tau=t+1}
    \frac{|y_{\tau}-\hat{y}_{\tau}|}{|y_{\tau}|} $$

|             | **Type**  | **Default** | **Details**                                   |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                               |
| y_hat       | ndarray   |             |                                               |
| weights     | Optional  | None        |                                               |
| axis        | Optional  | None        |                                               |
| **Returns** | **Union** |             | **Return the MAPE along the specified axis.** |

## Symmetric Mean Absolute Percentage Error

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L209"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### smape

> ``` text
>  smape (y:numpy.ndarray, y_hat:numpy.ndarray,
>         weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates Symmetric Mean Absolute Percentage Error (SMAPE) between y
and y_hat. SMAPE measures the relative prediction accuracy of a
forecasting method by calculating the relative deviation of the
prediction and the observed value scaled by the sum of the absolute
values for the prediction and observed value at a given time, then
averages these devations over the length of the series. This allows the
SMAPE to have bounds between 0% and 200% which is desireble compared to
normal MAPE that may be undetermined when the target is zero.

$$ \mathrm{SMAPE}_{2}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}) = 
   \frac{1}{H} \sum^{t+H}_{\tau=t+1} 
   \frac{|y_{\tau}-\hat{y}_{\tau}|}{|y_{\tau}|+|\hat{y}_{\tau}|} $$

|             | **Type**  | **Default** | **Details**                                    |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                                |
| y_hat       | ndarray   |             |                                                |
| weights     | Optional  | None        |                                                |
| axis        | Optional  | None        |                                                |
| **Returns** | **Union** |             | **Return the SMAPE along the specified axis.** |

# 3. Scale-independent Errors

## Mean Absolute Scaled Error

``` text
/opt/hostedtoolcache/Python/3.10.13/x64/lib/python3.10/site-packages/fastcore/docscrape.py:225: UserWarning: Unknown section References
  else: warn(msg)
```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L261"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### mase

> ``` text
>  mase (y:numpy.ndarray, y_hat:numpy.ndarray, y_train:numpy.ndarray,
>        seasonality:int, weights:Optional[numpy.ndarray]=None,
>        axis:Optional[int]=None)
> ```

Calculates the Mean Absolute Scaled Error (MASE) between y and y_hat.
MASE measures the relative prediction accuracy of a forecasting method
by comparinng the mean absolute errors of the prediction and the
observed value against the mean absolute errors of the seasonal naive
model. The MASE partially composed the Overall Weighted Average (OWA),
used in the M4 Competition.

$$ \mathrm{MASE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}, \mathbf{\hat{y}}^{season}_{\tau}) = 
    \frac{1}{H} \sum^{t+H}_{\tau=t+1} \frac{|y_{\tau}-\hat{y}_{\tau}|}{\mathrm{MAE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}^{season}_{\tau})} $$

|             | **Type**  | **Default** | **Details**                                   |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                               |
| y_hat       | ndarray   |             |                                               |
| y_train     | ndarray   |             |                                               |
| seasonality | int       |             |                                               |
| weights     | Optional  | None        |                                               |
| axis        | Optional  | None        |                                               |
| **Returns** | **Union** |             | **Return the mase along the specified axis.** |

## Relative Mean Absolute Error

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L318"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### rmae

> ``` text
>  rmae (y:numpy.ndarray, y_hat1:numpy.ndarray, y_hat2:numpy.ndarray,
>        weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates Relative Mean Absolute Error (RMAE) between two sets of
forecasts (from two different forecasting methods). A number smaller
than one implies that the forecast in the numerator is better than the
forecast in the denominator.

$$ \mathrm{RMAE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}_{\tau}, \mathbf{\hat{y}}^{base}_{\tau}) = 
    \frac{1}{H} \sum^{t+H}_{\tau=t+1} \frac{|y_{\tau}-\hat{y}_{\tau}|}{\mathrm{MAE}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}^{base}_{\tau})} $$

|             | **Type**  | **Default** | **Details**                                   |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                               |
| y_hat1      | ndarray   |             |                                               |
| y_hat2      | ndarray   |             |                                               |
| weights     | Optional  | None        |                                               |
| axis        | Optional  | None        |                                               |
| **Returns** | **Union** |             | **Return the RMAE along the specified axis.** |

# 4. Probabilistic Errors

## Quantile Loss

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L359"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### quantile_loss

> ``` text
>  quantile_loss (y:numpy.ndarray, y_hat:numpy.ndarray, q:float=0.5,
>                 weights:Optional[numpy.ndarray]=None,
>                 axis:Optional[int]=None)
> ```

Computes the quantile loss (QL) between y and y_hat. QL measures the
deviation of a quantile forecast. By weighting the absolute deviation in
a non symmetric way, the loss pays more attention to under or over
estimation.  
A common value for q is 0.5 for the deviation from the median.

$$ \mathrm{QL}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}^{(q)}_{\tau}) = 
    \frac{1}{H} \sum^{t+H}_{\tau=t+1} 
    \Big( (1-q)\,( \hat{y}^{(q)}_{\tau} - y_{\tau} )_{+} 
    + q\,( y_{\tau} - \hat{y}^{(q)}_{\tau} )_{+} \Big) $$

|             | **Type**  | **Default** | **Details**                                 |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                             |
| y_hat       | ndarray   |             |                                             |
| q           | float     | 0.5         |                                             |
| weights     | Optional  | None        |                                             |
| axis        | Optional  | None        |                                             |
| **Returns** | **Union** |             | **Return the QL along the specified axis.** |

## Multi-Quantile Loss

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L410"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### mqloss

> ``` text
>  mqloss (y:numpy.ndarray, y_hat:numpy.ndarray, quantiles:numpy.ndarray,
>          weights:Optional[numpy.ndarray]=None, axis:Optional[int]=None)
> ```

Calculates the Multi-Quantile loss (MQL) between y and y_hat. MQL
calculates the average multi-quantile Loss for a given set of quantiles,
based on the absolute difference between predicted quantiles and
observed values.

$$ \mathrm{MQL}(\mathbf{y}_{\tau},
                [\mathbf{\hat{y}}^{(q_{1})}_{\tau}, ... ,\hat{y}^{(q_{n})}_{\tau}]) = 
   \frac{1}{n} \sum_{q_{i}} \mathrm{QL}(\mathbf{y}_{\tau}, \mathbf{\hat{y}}^{(q_{i})}_{\tau}) $$

The limit behavior of MQL allows to measure the accuracy of a full
predictive distribution $\mathbf{\hat{F}}_{\tau}$ with the continuous
ranked probability score (CRPS). This can be achieved through a
numerical integration technique, that discretizes the quantiles and
treats the CRPS integral with a left Riemann approximation, averaging
over uniformly distanced quantiles.

$$ \mathrm{CRPS}(y_{\tau}, \mathbf{\hat{F}}_{\tau}) = 
    \int^{1}_{0} \mathrm{QL}(y_{\tau}, \hat{y}^{(q)}_{\tau}) dq $$

|             | **Type**  | **Default** | **Details**                                  |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                              |
| y_hat       | ndarray   |             |                                              |
| quantiles   | ndarray   |             |                                              |
| weights     | Optional  | None        |                                              |
| axis        | Optional  | None        |                                              |
| **Returns** | **Union** |             | **Return the MQL along the specified axis.** |

## Coverage

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L475"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### coverage

> ``` text
>  coverage (y:numpy.ndarray, y_hat_lo:numpy.ndarray,
>            y_hat_hi:numpy.ndarray)
> ```

Calculates the coverage of y with y_hat_lo and y_hat_hi.

|             | **Type**  | **Details**                       |
|-------------|-----------|-----------------------------------|
| y           | ndarray   |                                   |
| y_hat_lo    | ndarray   |                                   |
| y_hat_hi    | ndarray   |                                   |
| **Returns** | **Union** | **Return the coverage of y_hat.** |

## Calibration

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L502"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### calibration

> ``` text
>  calibration (y:numpy.ndarray, y_hat_hi:numpy.ndarray)
> ```

Calculates the fraction of y that is lower than y_hat_hi.

|             | **Type**  | **Details**                       |
|-------------|-----------|-----------------------------------|
| y           | ndarray   |                                   |
| y_hat_hi    | ndarray   |                                   |
| **Returns** | **Union** | **Return the coverage of y_hat.** |

## CRPS

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/datasetsforecast/tree/main/blob/main/datasetsforecast/losses.py#L527"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### scaled_crps

> ``` text
>  scaled_crps (y:numpy.ndarray, y_hat:numpy.ndarray,
>               quantiles:numpy.ndarray,
>               weights:Optional[numpy.ndarray]=None,
>               axis:Optional[int]=None)
> ```

Scaled Continues Ranked Probability Score

Calculates a scaled variation of the CRPS, as proposed by Rangapuram
(2021), to measure the accuracy of predicted quantiles `y_hat` compared
to the observation `y`. This metric averages percentual weighted
absolute deviations as defined by the quantile losses.

$$ \mathrm{sCRPS}(\hat{F}_{\tau}, \mathbf{y}_{\tau}) = \frac{2}{N} \sum_{i}
\int^{1}_{0}
\frac{\mathrm{QL}(\hat{F}_{i,\tau}, y_{i,\tau})_{q}}{\sum_{i} | y_{i,\tau} |} dq $$

Where $\hat{F}_{\tau}$ is the an estimated multivariate distribution,
and $y_{i,\tau}$ are its realizations.

|             | **Type**  | **Default** | **Details**                                          |
|------|------------------|-------------------------|-------------------------|
| y           | ndarray   |             |                                                      |
| y_hat       | ndarray   |             |                                                      |
| quantiles   | ndarray   |             |                                                      |
| weights     | Optional  | None        |                                                      |
| axis        | Optional  | None        |                                                      |
| **Returns** | **Union** |             | **Return the scaled crps along the specified axis.** |

